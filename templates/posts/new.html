{% extends "common/_content.html" %}
{% load duoshuo_tags %}
{% block css %}
<link rel="stylesheet" href="/site_media/css/article.css">
<link rel="stylesheet" href="/site_media/css/new.css">
<link rel="stylesheet" href="/site_media/css/common/uploadify.css"></script>
{% endblock %}
{% block title %}创作新主题{% endblock title %}
{% block body %}
{% include "common/tinymce.html" %}
    <form id="form" action="/new/" method="POST" accept-charset="utf-8">
    <div class="art">
        <article>
            <header class="art-header">
                <div class="art-detail">
                    <!--
                    <span class="tab-block">
                        <i class="fa fa-calendar-check-o fa-lg"></i>
                        <a href="#">2015-09-22 08:56</a>
                    </span>
                    <span class="tab-block">
                        <i class="fa fa-eye fa-lg"></i>
                        <a href="#">21K</a>
                    </span>
                    <span class="tab-block">
                        <i class="fa fa-comments-o fa-lg"></i>
                        <a href="#">210</a>
                    </span>
                    <span class="tab-block">
                        <i class="fa fa-star-o fa-lg"></i>
                        <a href="#">21</a>
                    </span>

                    <span class="tab-block">
                        <i class="fa fa-tag"></i>
                        <a href="#">风景</a>
                    </span>
                    -->
                    <span class="tab-block" style="font-size: 16px;font-weight: 600;">
                        标题：
                    </span>
                </div>
                <div class="art-title">
                    <h1>
                    <input class="msl-title" rows="1" maxlength="120" id="title" name="title" autofocus="autofocus" placeholder="请输入主题标题，如果标题能够表达完整内容，则正文可以为空"></input>
                    </h1>&nbsp;&nbsp;
                    <input type="radio" name="p_type" value="2"checked="checked">投票
                    <input type="radio" name="p_type" value="1">评论&nbsp;&nbsp;
                </div>
            </header>

            <textarea class="art-content" name="content" id="content" style="display: none;"></textarea>


            <div class="option-list">
                <div style="float: right; margin-right: 5px">
                    <button class="button_small" type="button" onclick="add_option()"><i class="fa fa-plus-square"></i>&nbsp;&nbsp;添加选项</button>
                </div>
                <span style="font-size: 16px;font-weight: 600;">选项：<br></span>
                <div class="o-option">
                    <div class="btnAndInput">
                        <textarea class="msl option" rows="5" maxlength="120" id="option" name="option_d1" placeholder="请输入要投票的选项"></textarea>
                        <button type="button" class="button_small" data-id="option">添加图片</button>
                    </div>
                    <div class="btnAndInput">
                        <textarea class="msl option" rows="5" maxlength="120" id="option1" name="option_d2" placeholder="请输入要投票的选项"></textarea>
                        <button type="button" class="button_small" data-id="option1">添加图片</button>
                    </div>
                    <div class="btnAndInput">
                        <textarea class="msl option" rows="5" maxlength="120" id="option2" name="option_d3" placeholder="请输入要投票的选项"></textarea>
                        <button type="button" class="button_small" data-id="option2">添加图片</button>
                    </div>
                </div>
            </div>
            <div class="tab-select">
                <select name="tag" id="select" class="from-control">
                    <option value="0" disabled selected>请选择一个节点</option>
                    {% for c in catalog_list %}
                        <option value="{{c.id}}">{{c.name}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="submit-bottom">
                <div class="btn-left">
                    <button type="button" onclick="submit_content()"><i class="fa fa-remove "></i>  清空内容</button>
                </div>
                <div class="btn-right">
                    <button type="button" onclick="submit_content()"><i class="fa fa-paper-plane"></i>  发布主题</button>
                </div>
            </div>
            <footer>
                <!--广告位-->
            </footer>
        </article>
    </div>
    </form>

<div class="hidden" id="imghidden" imgurlstr="">
</div>
{% endblock body %}

{% block js %}
<script src="/site_media/js/new.js" type="text/javascript" charset="utf-8"></script>
<script src="/site_media/js/jquery.form.js"></script>
<script src="/site_media/js/layer.js"></script>
<script src="/site_media/js/uploadify/jquery.uploadify.min.js"></script>
<script>
    $(function(){
        $("input:radio[name=p_type]").click(function() {
            var value = $(this).val();
            if (value === "2") {
                $(".mce-panel").hide();
                $(".option-list").show();
            }else{
                $(".mce-panel").show();
                $(".option-list").hide();
            }
        });

        $(".btnAndInput .button_small").click(function(){
            var text_id = $(this).attr('data-id');
            layer.open({
                type: 1,
                title: '上传图片',
                skin: 'layui-layer-rim', //加上边框
                area: ['420px', '240px'], //宽高
                btn: ['确定','取消'], //按钮
                btn1: function(){
                    var val = $("#"+text_id).val();
                    var val = val + $("#imghidden").attr('imgurlstr');
                    $("#"+text_id).val(val);
                },
                content: "<form class='fileForm' method='post' action='{{UPLOAD_IMG_API}}'><table class='fileTable'><tr><td>上传图片：</td><td><input id='smfile' name='smfile' type='file' multiple='true'></td></tr><tr><td></td><td id='img_show'><button type='button' onclick='ImageUpload()' class='button_small'>上传</button></td></tr></table></form>",
            });
        })
    });

</script>
{% endblock js %}
